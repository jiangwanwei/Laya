var WxJs=function(){function t(){new Http({url:API.SHARE_PARAMS,data:{url:location.href.replace(/\&/g,"|")}},this.init)}return t.prototype.init=function(t){Laya.Browser.window.wx.config({debug:t.debug||!1,appId:t.appId,timestamp:t.timestamp,nonceStr:t.nonceStr,signature:t.signature,jsApiList:["onMenuShareAppMessage","onMenuShareTimeline"]});var e=GameStart.SHARE_NAME,i=location.protocol+"//"+location.hostname+"/card/dump.html?member_id="+GameMain.MEMBER_ID,n=GameStart.SHARE_PIC;Laya.Browser.window.wx.ready(function(){Laya.Browser.window.wx.onMenuShareTimeline({title:e,link:i,imgUrl:n,success:function(t){new Http({url:API.SHARE_CREATE},function(t){if("object"!=typeof t){GameStart.isShared=!0,GameStart.chanceNum+=1,GameMain.GameView&&GameMain.GameView.updateChanceNum(),document.getElementById("share-model").style.display="none";var e=new noCloseDialog("\n恭 喜 您 获 得 \n \n 一次游戏机会","ui/btn_continue.png",function(){e.close(),GameMain.GameView&&GameMain.GameView.reset()});e.popup(!0),Laya.stage.addChild(e)}})}}),Laya.Browser.window.wx.onMenuShareAppMessage({title:e,desc:"挑战蛋糕师",link:i,imgUrl:n,type:"link",dataUrl:"",success:function(t){new Http({url:API.SHARE_CREATE},function(t){if("object"!=typeof t){GameStart.isShared=!0,GameStart.chanceNum+=1,GameMain.GameView&&GameMain.GameView.updateChanceNum(),document.getElementById("share-model").style.display="none";var e=new noCloseDialog("\n恭 喜 您 获 得 \n \n 一次游戏机会","ui/btn_continue.png",function(){e.close(),GameMain.GameView&&GameMain.GameView.reset()});e.popup(!0),Laya.stage.addChild(e)}})}})}),Laya.Browser.window.wx.error(function(t){alert(JSON.stringify(t))})},t.shareSuccess=function(){new Http({url:API.SHARE_CREATE},function(t){if("object"!=typeof t){GameStart.isShared=!0,GameStart.chanceNum+=1,GameMain.GameView&&GameMain.GameView.updateChanceNum(),document.getElementById("share-model").style.display="none";var e=new noCloseDialog("\n恭 喜 您 获 得 \n \n 一次游戏机会","ui/btn_continue.png",function(){e.close(),GameMain.GameView&&GameMain.GameView.reset()});e.popup(!0),Laya.stage.addChild(e)}})},t}(),API=function(){function t(){}return t.PARAMS="/tools-fans",t.LOOP_AWRAD_LIST="/tools-fans/win-info",t.INFO="/tools-fans/create",t.AWRAD_LIST="/tools-fans-user-info",t.BIND_USER="/bind-wx-openid",t.SHARE_PARAMS="/wechat-share",t.SHARE_CREATE="/wechat-share/create",t.SHARE_STATE="/wechat-shared",t.HELP="/wechat-help",t}(),codeState={2e4:"参数错误",21002:"用户已绑定"},Http=function(){function t(t,e,i){void 0===i&&(i=function(){});var n=new Laya.HttpRequest;n.once(Laya.Event.COMPLETE,null,function(t){t.code?(alert(codeState[t.code]||t.code),i(JSON.parse(t))):e(JSON.parse(t).data||JSON.parse(t))}),n.once(Laya.Event.ERROR,this,this.errHandle);var a="?";for(var o in t.data)a+=o+"="+t.data[o]+"&";n.send("http://"+location.hostname.replace(/^game/,"a")+"/game"+t.url+a,"",t.type||"get","text",["Authorization",GameMain.TOKEN])}return t.prototype.errHandle=function(){alert("请求出错")},t}(),LayaStage=Laya.Stage,Loader=Laya.Loader,Hander=Laya.Handler,GameMain=function(){function t(){this.setStageParams(),this.initLoading()}return t.prototype.setStageParams=function(){Laya.init(640,1009,Laya.WebGL),Laya.stage.bgColor="#000000",Laya.stage.scaleMode=LayaStage.SCALE_SHOWALL,Laya.stage.alignH=LayaStage.ALIGN_CENTER,Laya.stage.screenMode=LayaStage.SCREEN_VERTICAL},t.prototype.initLoading=function(){var t=this,e=[{url:"res/atlas/loading.atlas",type:Loader.ATLAS}];Laya.loader.load(e,Hander.create(null,function(e){t.loading=new Loading,Laya.stage.addChild(t.loading),t.init()}))},t.prototype.init=function(){var t=[{url:"ui/card_init.jpg",type:Loader.IMAGE},{url:"ui/clip_num.png",type:Loader.IMAGE},{url:"ui/game-view-bg.jpg",type:Loader.IMAGE},{url:"ui/grid-bg.jpg",type:Loader.IMAGE},{url:"ui/gril.png",type:Loader.IMAGE},{url:"ui/tip-bg.jpg",type:Loader.IMAGE},{url:"ui/title.png",type:Loader.IMAGE},{url:"res/atlas/ui.atlas",type:Loader.ATLAS}];Laya.loader.load(t,Hander.create(this,this.onLoadComplete),Hander.create(this,this.onLoadProgress))},t.prototype.onLoadProgress=function(t){this.loading.progress.text=(100*t).toFixed(0)+"%"},t.prototype.onLoadComplete=function(){var t=this;this.loading.progress.text="100%",Laya.Tween.to(this.loading,{alpha:0},200,Laya.Ease.bounceInOut,Hander.create(null,function(){Laya.stage.bgColor="#ff5529",t.loading.visible=!1,t.loading.removeSelf(),t.loading.destroy(),t.technicalSupport(),t.loadGameStart()}))},t.prototype.loadGameStart=function(){if(t.OPPEN_ID=t.GetQueryString("openid"),t.TOKEN=t.GetQueryString("token"),t.MEMBER_ID=t.GetQueryString("member_id"),t.SHARE_ID=t.GetQueryString("share_id"),t.TOKEN=t.TOKEN,t.GameStart=new GameStart,Laya.stage.addChild(t.GameStart),t.SHARE_ID&&"nothing"!==t.SHARE_ID)return t.GameStart.showHelpPage();if(GameStart.getGameParams(),t.OPPEN_ID){var e=new InputMobile;e.popup(!0),Laya.stage.addChild(e)}},t.prototype.technicalSupport=function(){var t=new Laya.Text;t.text="技术支持：迈小步科技",t.color="#fff",t.fontSize=16,t.x=(Laya.stage.width-t.width)/2,t.y=Laya.stage.height-18,t.zOrder=100,Laya.stage.addChild(t)},t.returnHome=function(){t.GameView.noCloseDialog&&t.GameView.noCloseDialog.close(),t.GameView.removeSelf(),Laya.stage.addChild(t.GameStart)},t.GetQueryString=function(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),i=window.location.search.substr(1).match(e);return null!=i?decodeURIComponent(i[2]):null},t.getAndSetUserChance=function(e,i){void 0===e&&(e=""),void 0===i&&(i=""),new Http({url:API.INFO,data:{mark:e,win_info:i}},function(e){GameStart.historyChanceNum=~~e.allTime,GameStart.chanceNum=e.surplus_times,t.GameView&&t.GameView.updateChanceNum()})},t}();new GameMain;var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),View=laya.ui.View,Dialog=laya.ui.Dialog,ui;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.createView(t.GameViewUI.uiView)},i.uiView={type:"View",props:{width:640,height:1009},child:[{type:"Box",props:{y:0,x:0,width:640},child:[{type:"Image",props:{y:0,x:0,skin:"ui/game-view-bg.jpg"}},{type:"Image",props:{y:0,x:0,width:640,skin:"ui/top-bg.png",height:62,sizeGrid:"0,0,0,0,1"}},{type:"Image",props:{y:106,x:256,skin:"ui/chance-bg.png"}},{type:"Image",props:{y:74,x:89,skin:"ui/avatar.png"}},{type:"Image",props:{y:128,x:465,var:"btn_home",skin:"ui/home-txt.png"}}]},{type:"Clip",props:{y:105,x:317,width:56,var:"chanceNumClip",skin:"ui/clip_num.png",index:0,height:60,clipX:10,clipWidth:56}},{type:"List",props:{y:234,x:5,width:630,var:"cardList",spaceY:7,spaceX:7,repeatY:3,repeatX:3,height:748},child:[{type:"Box",props:{y:0,x:0,width:206,name:"render",height:245},child:[{type:"Image",props:{skin:"ui/card-bg.png"}},{type:"Image",props:{y:50,x:102,width:150,skin:"ui/card_init.jpg",name:"card",height:172,anchorX:.5}}]}]}]},i}(View);t.GameViewUI=e}(ui||(ui={})),function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.createView(t.HelpViewUI.uiView)},i.uiView={type:"View",props:{width:640,height:1009}},i}(View);t.HelpViewUI=e}(ui||(ui={})),function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.createView(t.IndexUI.uiView)},i.uiView={type:"View",props:{width:640,height:1009},child:[{type:"Image",props:{y:0,x:0,width:640,skin:"ui/grid-bg.jpg",sizeGrid:"0,0,0,0,1",height:1009}},{type:"Image",props:{y:293,x:0,var:"girl",skin:"ui/gril.png"}},{type:"Image",props:{y:803,x:121,var:"btn_bigin",skin:"ui/begin_btn.png.png"}},{type:"Image",props:{y:881,x:500,var:"btn_my_award",skin:"ui/my_award_btn.png"}},{type:"Image",props:{y:881,x:0,var:"btn_rule",skin:"ui/rule_btn.png"}},{type:"Image",props:{y:62,x:0,width:642,skin:"ui/tip-bg.jpg",sizeGrid:"5,6,5,47",height:40}},{type:"Image",props:{y:103,x:-1,skin:"ui/title.png"}},{type:"Image",props:{y:0,x:0,width:641,skin:"ui/top-bg.png",sizeGrid:"0,0,0,0,1",height:62}},{type:"Label",props:{y:64,x:2,width:636,var:"loop_label",valign:"middle",height:37,color:"#6a2707"}},{type:"Image",props:{y:141,x:36,width:579,visible:!1,var:"rule",skin:"ui/dialog-bg.png",sizeGrid:"57,54,16,15",height:798},child:[{type:"Image",props:{y:55,x:29,skin:"ui/rule-txt.png"}},{type:"Label",props:{y:7,x:524,width:51,var:"btn_rule_close",height:54}}]},{type:"Image",props:{y:116,x:48,width:568,visible:!0,var:"my_award",skin:"ui/dialog-bg.png",height:847,sizeGrid:"57,54,16,15"},child:[{type:"Image",props:{y:49,x:34,skin:"ui/my-award-title.png"}},{type:"Image",props:{y:729,x:29,skin:"ui/my-award-rule.png"}},{type:"Image",props:{y:664,x:119,var:"shareTo",skin:"ui/my-award-btn.png"}},{type:"Label",props:{y:5,x:512,width:50,var:"btn_close_award",height:54}},{type:"List",props:{y:156,x:36,width:490,var:"my_award_list",vScrollBarSkin:"ui/vscroll.png",spaceY:0,repeatY:5,height:478},child:[{type:"Box",props:{name:"render"},child:[{type:"Label",props:{width:490,height:85,bgColor:"#ffeac1"}},{type:"Label",props:{y:29,x:24,width:144,text:"2017-12-07",name:"time",height:33,fontSize:24,color:"#f57747"}},{type:"Label",props:{y:29,x:192,width:144,text:"XXXX蛋糕券",name:"name",height:33,fontSize:24,color:"#f57747"}},{type:"Label",props:{y:29,x:380,width:77,text:"1",name:"num",height:33,fontSize:24,color:"#f57747",align:"center"}}]}]}]},{type:"Image",props:{y:307,x:97,visible:!1,var:"help_img",skin:"ui/help_img.png"}},{type:"Image",props:{y:877,x:119,visible:!1,var:"btn_help",skin:"ui/help_btn.png",mouseEnabled:!0}}]},i}(View);t.IndexUI=e}(ui||(ui={})),function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.createView(t.LoadingUI.uiView)},i.uiView={type:"View",props:{width:640,height:1009},child:[{type:"Label",props:{y:0,x:0,width:640,var:"bg",height:1009,bgColor:"#000000"}},{type:"Text",props:{y:484,x:200,width:209,var:"mxb",text:"迈小步科技制作",height:74,fontSize:24,color:"#ffffff",align:"center"},compId:4},{type:"Text",props:{y:403,x:251,width:108,var:"progress",text:"10%",height:91,fontSize:28,color:"#ffffff",align:"center"}},{type:"Image",props:{y:416,x:304,skin:"loading/loading.png",anchorY:.5,anchorX:.5},compId:6}],animations:[{nodes:[{target:4,keyframes:{fontSize:[{value:24,tweenMethod:"linearNone",tween:!0,target:4,key:"fontSize",index:0},{value:24,tweenMethod:"linearNone",tween:!0,target:4,key:"fontSize",index:30}]}},{target:6,keyframes:{rotation:[{value:0,tweenMethod:"linearNone",tween:!0,target:6,key:"rotation",index:0},{value:360,tweenMethod:"linearNone",tween:!0,target:6,key:"rotation",index:30}]}}],name:"loading",id:1,frameRate:24,action:2}]},i}(View);t.LoadingUI=e}(ui||(ui={})),function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.createView(t.MyDialogUI.uiView)},i.uiView={type:"Dialog",props:{width:560,height:400},child:[{type:"Image",props:{y:0,x:0,width:560,skin:"ui/dialog-bg.png",height:400,sizeGrid:"57,54,16,15"}},{type:"Label",props:{y:16,x:512,width:33,var:"btn_close",height:31}},{type:"Button",props:{y:291,x:75,var:"confim",stateNum:1,skin:"ui/btn_continue.png"}},{type:"Label",props:{y:74,x:98,width:356,var:"context",height:44,fontSize:30,color:"#ff643c",align:"center"}},{type:"Image",props:{y:133,x:208,width:123,var:"awardImg",height:141}},{type:"Image",props:{y:102,x:60,var:"txtImg"}}]},i}(Dialog);t.MyDialogUI=e}(ui||(ui={})),function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.createView(t.baseDialogUI.uiView)},i.uiView={type:"Dialog",props:{width:640,height:1009},child:[{type:"Label",props:{y:0,width:640,height:1009,bgColor:"#060606",alpha:.1}},{type:"Image",props:{y:304,x:40,width:560,skin:"ui/dialog-bg-noclose.png",sizeGrid:"13,15,12,15",height:400},child:[{type:"Button",props:{y:292,x:75,var:"confim",stateNum:1,skin:"ui/btn_continue.png"}},{type:"Label",props:{y:74,x:45,width:469,var:"context",height:44,fontSize:30,color:"#ff643c",align:"center"}},{type:"Image",props:{y:133,x:208,width:123,var:"awardImg",height:141}},{type:"Image",props:{y:102,x:60,var:"txtImg"}}]}]},i}(Dialog);t.baseDialogUI=e}(ui||(ui={})),function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.createView(t.inputMobileUI.uiView)},i.uiView={type:"Dialog",props:{width:640,height:1009},child:[{type:"Label",props:{y:0,x:0,width:640,height:1009,bgColor:"#060606",alpha:.1}},{type:"Image",props:{y:320,x:51,width:537,skin:"ui/dialog-bg-noclose.png",height:369,sizeGrid:"13,15,12,15"}},{type:"Image",props:{y:575,x:79,skin:"ui/mobile_tips_txt.png"}},{type:"TextInput",props:{y:371,x:88,width:468,var:"mobile_input",skin:"ui/input_bg.png",sizeGrid:"14,12,14,12",height:73}},{type:"Button",props:{y:474,x:165,var:"mobile_confim",stateNum:1,skin:"ui/btn_ipt_ok.png"}}]},i}(Dialog);t.inputMobileUI=e}(ui||(ui={}));var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),GameStart=function(t){function e(){var i=t.call(this)||this;return i.LOOP_TEXT_UNIT_WIDTH=300,i.bindEvent(),document.body.style.background="#f57759",i.getLoopList(),GameMain.TOKEN&&(GameMain.getAndSetUserChance("read"),new Http({url:API.SHARE_STATE},function(t){e.isShared=!!t.share_times})),i.my_award_list.dataSource=[],i}return __extends(e,t),e.prototype.bindEvent=function(){var t=this;this.btn_rule.on(Laya.Event.MOUSE_DOWN,this,this.setRuleState(!0,this.rule)),this.btn_rule_close.on(Laya.Event.MOUSE_DOWN,this,this.setRuleState(!1,this.rule)),this.setDefaultProp(this.rule),this.btn_my_award.on(Laya.Event.MOUSE_DOWN,null,function(e){t.setRuleState(!0,t.my_award)(),GameMain.TOKEN&&t.getMyAwardList()}),this.btn_close_award.on(Laya.Event.MOUSE_DOWN,this,this.setRuleState(!1,this.my_award)),this.setDefaultProp(this.my_award),this.btn_bigin.on(Laya.Event.MOUSE_DOWN,this,this.beginHandle),this.shareTo.on(Laya.Event.CLICK,null,function(t){GameView.showHtmlTip("share-model")})},e.prototype.getLoopList=function(){var t=this;new Http({url:API.LOOP_AWRAD_LIST},function(e){e=e.splice(0,5),e.forEach(function(t){t.member_mobile=t.member_mobile.substr(0,3)+"****"+t.member_mobile.substr(7);for(var e in t.win_info)t.win_name=e}),t.LOOP_TEXT_DATA=e,t.setLoopList()})},e.getGameParams=function(){new Http({url:API.PARAMS},function(t){var i=t.prize_rate,n=t.prize_options;for(var a in i)i[a].name=a,e.PRIZE_RATE.push(i[a]);e.PRIZE_RATE.sort(function(t,e){return t.times>e.times||-1});for(var a in n)!function(t){n[t].coupon&&n[t].coupon.forEach(function(i,n){i.name=t+"-coupon-"+n,e.ALL_PRIZE.push(i)}),n[t].integral&&n[t].integral.forEach(function(i,n){i.name=t+"-integral-"+n,e.ALL_PRIZE.push(i)})}(a);e.SHARE_NAME=t.share_name,e.SHARE_PIC=t.share_pic;var o=new Image;o.src=t.share_pic,o.style.width="0",o.style.height="0",o.style.opacity="0",document.body.appendChild(o),new WxJs})},e.prototype.getMyAwardList=function(){var t=this;new Http({url:API.AWRAD_LIST},function(e){e.forEach(function(t){t.time=t.win_date,t.num=1;for(var e in JSON.parse(t.win_info))t.name=e}),t.my_award_list.dataSource=e})},e.prototype.setDefaultProp=function(t){t.scaleX=.7,t.scaleY=.7,t.alpha=0,t.anchorX=.5,t.anchorY=.5,t.y=1e3+t.height/2,t.pos(Laya.stage.width/2,Laya.stage.height/2)},e.prototype.setRuleState=function(t,e){var i=this;return function(){if(i.rule.visible=!1,i.my_award.visible=!1,t){var n={scaleX:1,scaleY:1,alpha:1,y:115+e.height/2};return e.visible=t,void Laya.Tween.to(e,n,200,Laya.Ease.backOut)}i.setDefaultProp(e)}},e.prototype.beginHandle=function(){if(e.PRIZE_RATE.length<1)return alert("游戏参数获取中...请稍等");GameMain.TOKEN?(this.removeSelf(),GameMain.GameView||(GameMain.GameView=new GameView),GameMain.GameView.reset(),Laya.stage.addChild(GameMain.GameView)):alert("url有误")},e.prototype.setLoopList=function(){var t=this,e=new Laya.Sprite;e.graphics.drawRect(50,0,523,37,"#ffffff"),this.loop_label.mask=e,this.LOOP_TEXT_DATA.forEach(function(e,i){var n=new Laya.Text;n.text="恭喜用户 "+e.member_mobile+" 获得"+e.win_name+"~",n.y=12,n.x=60+t.LOOP_TEXT_UNIT_WIDTH*i,t.loop_label.addChild(n)}),this.LOOP_TEXT_DATA.length>1&&Laya.timer.frameLoop(1,this,this.loopText)},e.prototype.loopText=function(){for(var t=1,e=this.loop_label.numChildren;t<e;t++){var i=this.loop_label.getChildAt(t);i.x-=1,i.x<=-this.LOOP_TEXT_UNIT_WIDTH&&(i.x=300*(e-2))}},e.prototype.showHelpPage=function(){this.btn_bigin.visible=!1,this.btn_my_award.visible=!1,this.btn_rule.visible=!1,this.btn_bigin.visible=!1,this.girl.y=430,this.help_img.visible=!0,this.btn_help.visible=!0,this.btn_help.on(Laya.Event.CLICK,this,this.helpHanlde)},e.prototype.helpHanlde=function(){var t={share_member_id:GameMain.SHARE_ID};GameMain.OPPEN_ID?t.help_member_openid=GameMain.OPPEN_ID:t.help_member_id=GameMain.MEMBER_ID,new Http({url:API.HELP,data:t},function(t){var e="number"!=typeof t?"\b\n \n 助力成功~ 非常感谢！":" \n 您今天已经助力过啦~ \n \n 明天再来吧！",i=new MyDialog(e,function(t){var e=location.origin+location.pathname+"?";e+=GameMain.OPPEN_ID?"openid="+GameMain.OPPEN_ID:"&token="+GameMain.TOKEN,location.href=e});i.confim.y=240,i.confim.x=123,i.confim.skin="ui/btn_join.png",i.popup(!0),Laya.stage.addChild(i)})},e.chanceNum=0,e.isShared=!1,e.PRIZE_RATE=[],e.ALL_PRIZE=[],e}(ui.IndexUI),__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),GameView=function(t){function e(){var e=t.call(this)||this;return e.cardNum=9,e.cardList.mouseHandler=Laya.Handler.create(e,e.cardSelect,null,!1),e.btn_home.on(Laya.Event.CLICK,e,GameMain.returnHome),e.updateChanceNum(),e}return __extends(e,t),e.prototype.reset=function(){Laya.stage.bgColor="#ff5529",document.body.style.background="#ff5529",e.isAllow=!1,this.curAwardName="",this.initCardListAnimate()},e.prototype.initCardListAnimate=function(){for(var t=[],i=0;i<this.cardNum;i++){t.push({card:{skin:"ui/card_init.jpg"}}),this.cardList.getCell(i).x=0,this.cardList.getCell(i).y=0;var n={};-1!==[0,3,6].indexOf(i)?n.x=0:-1!==[1,4,7].indexOf(i)?n.x=211:n.x=422,-1!==[0,1,2].indexOf(i)?n.y=0:-1!==[3,4,5].indexOf(i)?n.y=252:n.y=504,Laya.Tween.to(this.cardList.getCell(i),n,200,Laya.Ease.bounceInOut,null,100*i)}Laya.timer.once(100*this.cardNum,null,function(){e.isAllow=!0}),this.cardList.dataSource=t},e.prototype.updateChanceNum=function(){this.chanceNumClip.index=GameStart.chanceNum},e.prototype.cardSelect=function(t,i){if(t.stopPropagation(),"mousedown"===t.type){if(!e.isAllow||!this.GameStateCheck())return;e.isAllow=!1,this.curIndex=i,Laya.Tween.to(this.cardList.getCell(i).getChildByName("card"),{skewY:360},300,Laya.Ease.bounceIn,Laya.Handler.create(this,this.setCurCardResult));var n,a=Math.ceil(100*Math.random())<10,o={};if(a&&(GameStart.PRIZE_RATE.forEach(function(t){GameStart.historyChanceNum>=t.times&&(n=t.name)}),n)){var r=GameStart.ALL_PRIZE.filter(function(t){return 0===t.name.search(n)});r.sort(function(t,e){return Math.random()-.5||-1}),n=r[0].name;var s=n.split("-"),p=s[0],l=s[1];o[p]=(h={},h[l]=[r[0]],h)}GameStart.chanceNum-=1,GameStart.historyChanceNum+=1,this.updateChanceNum(),GameMain.getAndSetUserChance("",JSON.stringify(o)),this.curAwardName=n}var h},e.prototype.setCurCardResult=function(){var t={card:{skin:this.curAwardName?"ui/"+this.curAwardName+".jpg":"ui/no_award.png"}};this.cardList.setItem(this.curIndex,t),Laya.timer.once(300,this,this.setOtherCardResult)},e.prototype.setOtherCardResult=function(){var t=[],e=GameStart.ALL_PRIZE.filter(function(t){return 0===t.name.search("一等奖")});e.sort(function(t){return Math.random()-.5||-1});var i=JSON.parse(JSON.stringify(GameStart.ALL_PRIZE));for(i.sort(function(t){return Math.random()-.5||-1});i.length<9;)i=i.concat(i);if(e.length>0){for(var n=Math.floor(9*Math.random());n===this.curIndex;)n=Math.floor(9*Math.random());i[n]=e[0]}for(var a=0;a<this.cardNum;a++){if(a===this.curIndex)var o={card:{skin:this.curAwardName?"ui/"+this.curAwardName+".jpg":"ui/no_award.png"}};else var r=Math.floor(100*Math.random()),s=r<15?0:1,o={card:{skin:s?"ui/"+i[a].name+".jpg":"ui/no_award.png"}};o.card.skewY=0,t.push(o)}this.cardList.dataSource=t,Laya.timer.once(1500,this,this.showResult)},e.prototype.showResult=function(){var t=this,e="恭 喜 您 获 得";this.curAwardName||(e="\n 运气不佳，差一点点~ \n \n 再接再厉！"),this.noCloseDialog=new noCloseDialog(e,"ui/btn_continue.png",function(){t.noCloseDialog.close(),t.GameStateCheck()&&t.reset()}),this.curAwardName?this.noCloseDialog.awardImg.skin="ui/"+this.curAwardName+".jpg":(this.noCloseDialog.awardImg.removeSelf(),this.noCloseDialog.confim.y=260),this.noCloseDialog.popup(!0),Laya.stage.addChild(this.noCloseDialog)},e.prototype.GameStateCheck=function(){return GameStart.chanceNum<=0&&!GameStart.isShared?(this.haveToShareDialog(),!1):!(GameStart.chanceNum<=0)||(this.todayNoChance(),!1)},e.prototype.haveToShareDialog=function(){var t=this;this.noCloseDialog=new noCloseDialog("","ui/btn_share.png",function(){t.noCloseDialog.close(),e.showHtmlTip("share-model")}),this.noCloseDialog.txtImg.skin="ui/nochance_txt.png",this.noCloseDialog.popup(!0),Laya.stage.addChild(this.noCloseDialog)},e.prototype.haveToFollow=function(){var t=this;this.noCloseDialog=new noCloseDialog('\n \b点击关注公众号 "\b迈小步科技"\n \n 可提高概率哦~',"ui/btn_follow.png",function(){t.noCloseDialog.close(),e.showHtmlTip("follow-model")}),this.noCloseDialog.confim.y=260,this.noCloseDialog.popup(!0),Laya.stage.addChild(this.noCloseDialog)},e.prototype.todayNoChance=function(){var t=this;this.noCloseDialog=new noCloseDialog("\n \b今天的机会已经用完啦，\b\n\b\n 明天再来吧~","ui/btn_bye.png",function(e){t.noCloseDialog.close()}),this.noCloseDialog.popup(!0),this.noCloseDialog.confim.y=260,Laya.stage.addChild(this.noCloseDialog)},e.showHtmlTip=function(t){document.getElementById(t).style.display="block"},e.isFollow=!1,e.isAllow=!1,e}(ui.GameViewUI),__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),InputMobile=function(t){function e(){var e=t.call(this)||this;return e.setInputProps(),e.mobile_confim.on(Laya.Event.CLICK,e,e.confimHandle),e}return __extends(e,t),e.prototype.setInputProps=function(){this.mobile_input.restrict="0123456789",this.mobile_input.maxChars=11,this.mobile_input.align=Laya.Stage.ALIGN_CENTER,this.mobile_input.fontSize=28,this.mobile_input.color="#272626",this.mobile_input.prompt="请输入您的手机号码"},e.prototype.confimHandle=function(){if(!/^(0?(13|15|18|14|17)[0-9]{9})$/.test(this.mobile_input.text))return void alert("请输入正确的手机号码");var t=new Loading;t.hide(),Laya.stage.addChild(t),new Http({url:API.BIND_USER,data:{mobile:this.mobile_input.text,wx_openid:GameMain.OPPEN_ID}},function(t){location.href=location.origin+location.pathname+"?token="+t.token+"&member_id="+t.member_id},function(e){t.removeSelf(),t.destroy()})},e}(ui.inputMobileUI),__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Loading=function(t){function e(){var e=t.call(this)||this;return e.progress.text="0%",e}return __extends(e,t),e.prototype.hide=function(){this.bg.alpha=.3,this.mxb.visible=!1,this.progress.text=""},e}(ui.LoadingUI),__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),MyDialog=function(t){function e(e,i){var n=t.call(this)||this;return n.context.text=e,n.btn_close.on(Laya.Event.CLICK,n,n.close),n.confim.on(Laya.Event.CLICK,n,i),n.dragArea="7,21,493,18",n.closeEffect=null,n}return __extends(e,t),e}(ui.MyDialogUI),__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),noCloseDialog=function(t){function e(e,i,n){var a=t.call(this)||this;return a.init(),a.context.text=e,a.confim.once(Laya.Event.CLICK,a,n),a.closeEffect=null,a.confim.skin=i,a}return __extends(e,t),e.prototype.init=function(){this.context.text="",this.context.x=98,this.context.y=74,this.context.width=356,this.awardImg.skin="",this.awardImg.x=208,this.awardImg.y=133,this.awardImg.width=123,this.awardImg.height=141,this.txtImg.x=60,this.txtImg.y=120,this.txtImg.skin="",this.confim.y=292},e}(ui.baseDialogUI);