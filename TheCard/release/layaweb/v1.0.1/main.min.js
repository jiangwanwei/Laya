var LayaStage=Laya.Stage,Loader=Laya.Loader,Hander=Laya.Handler,GameMain=function(){function t(){Laya.init(640,1009,Laya.WebGL),Laya.stage.bgColor="#000000",Laya.stage.scaleMode=LayaStage.SCALE_SHOWALL,Laya.stage.alignH=LayaStage.ALIGN_CENTER,Laya.stage.screenMode=LayaStage.SCREEN_VERTICAL,this.initLoading()}return t.prototype.initLoading=function(){var t=this,e=[{url:"res/atlas/loading.atlas",type:Loader.ATLAS}];Laya.loader.load(e,Hander.create(null,function(e){t.loading=new Loading,Laya.stage.addChild(t.loading),t.init()}))},t.prototype.init=function(){var t=[{url:"ui/card_init.jpg",type:Loader.IMAGE},{url:"ui/clip_num.png",type:Loader.IMAGE},{url:"ui/game-view-bg.jpg",type:Loader.IMAGE},{url:"ui/grid-bg.jpg",type:Loader.IMAGE},{url:"ui/gril.png",type:Loader.IMAGE},{url:"ui/tip-bg.jpg",type:Loader.IMAGE},{url:"ui/rule-txt.png",type:Loader.IMAGE},{url:"ui/title.png",type:Loader.IMAGE},{url:"res/atlas/ui.atlas",type:Loader.ATLAS}];Laya.loader.load(t,Hander.create(this,this.onLoadComplete),Hander.create(this,this.onLoadProgress))},t.prototype.onLoadProgress=function(t){this.loading.progress.text=(100*t).toFixed(0)+"%"},t.prototype.onLoadComplete=function(){var t=this;this.loading.progress.text="100%",Laya.Tween.to(this.loading,{alpha:0},200,Laya.Ease.bounceInOut,Hander.create(null,function(){Laya.stage.bgColor="#ff5529",t.loading.visible=!1,t.loading.removeSelf(),t.loading.destroy(),t.technicalSupport(),t.loadGameStart()}))},t.prototype.loadGameStart=function(){t.GameStart=new GameStart,Laya.stage.addChild(t.GameStart)},t.prototype.technicalSupport=function(){var t=new Laya.Text;t.text="技术支持：迈小步科技",t.color="#fff",t.fontSize=16,t.x=(Laya.stage.width-t.width)/2,t.y=Laya.stage.height-18,t.zOrder=100,Laya.stage.addChild(t)},t.returnHome=function(){t.GameView.noCloseDialog.close(),t.GameView.removeSelf(),Laya.stage.addChild(t.GameStart)},t.createLockLayer=function(){var t=new Laya.Sprite;return t.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000000"),t.graphics.setAlpha(.7),t.graphics.save(),t},t}();new GameMain;var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function a(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(a.prototype=i.prototype,new a)}}(),View=laya.ui.View,Dialog=laya.ui.Dialog,ui;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.createView(t.GameViewUI.uiView)},i.uiView={type:"View",props:{width:640,height:1009},child:[{type:"Box",props:{y:0,x:0,width:640},child:[{type:"Image",props:{y:0,x:0,skin:"ui/game-view-bg.jpg"}},{type:"Image",props:{y:0,x:0,width:640,skin:"ui/top-bg.png",height:62,sizeGrid:"0,0,0,0,1"}},{type:"Image",props:{y:106,x:256,skin:"ui/chance-bg.png"}},{type:"Image",props:{y:74,x:89,skin:"ui/avatar.png"}},{type:"Image",props:{y:128,x:465,var:"btn_home",skin:"ui/home-txt.png"}}]},{type:"Clip",props:{y:105,x:317,width:56,var:"chanceNumClip",skin:"ui/clip_num.png",index:0,height:60,clipX:9,clipWidth:56}},{type:"List",props:{y:234,x:5,width:630,var:"cardList",spaceY:7,spaceX:7,repeatY:3,repeatX:3,height:748},child:[{type:"Box",props:{y:0,x:0,width:206,name:"render",height:245},child:[{type:"Image",props:{skin:"ui/card-bg.png"}},{type:"Image",props:{y:50,x:102,skin:"ui/card_init.jpg",name:"card",anchorX:.5}}]}]}]},i}(View);t.GameViewUI=e}(ui||(ui={})),function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.createView(t.IndexUI.uiView)},i.uiView={type:"View",props:{width:640,height:1009},child:[{type:"Image",props:{y:0,x:0,width:640,skin:"ui/grid-bg.jpg",sizeGrid:"0,0,0,0,1",height:1009}},{type:"Image",props:{y:293,x:0,skin:"ui/gril.png"}},{type:"Image",props:{y:803,x:121,var:"btn_bigin",skin:"ui/begin_btn.png.png"}},{type:"Image",props:{y:881,x:500,var:"btn_my_award",skin:"ui/my_award_btn.png"}},{type:"Image",props:{y:881,x:0,var:"btn_rule",skin:"ui/rule_btn.png"}},{type:"Image",props:{y:62,x:0,width:642,skin:"ui/tip-bg.jpg",sizeGrid:"5,6,5,47",height:40}},{type:"Image",props:{y:103,x:-1,skin:"ui/title.png"}},{type:"Image",props:{y:0,x:0,width:641,skin:"ui/top-bg.png",sizeGrid:"0,0,0,0,1",height:62}},{type:"Label",props:{y:64,x:56,width:565,valign:"middle",text:"恭喜XXX获得123蛋糕裙一张~",height:37,color:"#6a2707"}},{type:"Image",props:{y:141,x:36,width:579,visible:!1,var:"rule",skin:"ui/dialog-bg.png",sizeGrid:"57,54,16,15",height:798},child:[{type:"Image",props:{y:55,x:29,skin:"ui/rule-txt.png"}},{type:"Label",props:{y:7,x:524,width:51,var:"btn_rule_close",height:54}}]},{type:"Image",props:{y:116,x:48,width:568,var:"my_award",skin:"ui/dialog-bg.png",height:847,sizeGrid:"57,54,16,15"},child:[{type:"Image",props:{y:49,x:34,skin:"ui/my-award-title.png"}},{type:"Image",props:{y:729,x:29,skin:"ui/my-award-rule.png"}},{type:"Image",props:{y:664,x:119,skin:"ui/my-award-btn.png"}},{type:"Label",props:{y:5,x:512,width:50,var:"btn_close_award",height:54}}]}]},i}(View);t.IndexUI=e}(ui||(ui={})),function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.createView(t.LoadingUI.uiView)},i.uiView={type:"View",props:{width:640,height:1009},child:[{type:"Label",props:{y:0,x:0,width:640,height:1009,bgColor:"#000000"}},{type:"Text",props:{y:484,x:200,width:209,text:"迈小步科技制作",height:74,fontSize:24,color:"#ffffff",align:"center"},compId:4},{type:"Text",props:{y:403,x:251,width:108,var:"progress",text:"10%",height:91,fontSize:28,color:"#ffffff",align:"center"}},{type:"Image",props:{y:416,x:304,skin:"loading/loading.png",anchorY:.5,anchorX:.5},compId:6}],animations:[{nodes:[{target:4,keyframes:{fontSize:[{value:24,tweenMethod:"linearNone",tween:!0,target:4,key:"fontSize",index:0},{value:24,tweenMethod:"linearNone",tween:!0,target:4,key:"fontSize",index:30}]}},{target:6,keyframes:{rotation:[{value:0,tweenMethod:"linearNone",tween:!0,target:6,key:"rotation",index:0},{value:360,tweenMethod:"linearNone",tween:!0,target:6,key:"rotation",index:30}]}}],name:"loading",id:1,frameRate:24,action:2}]},i}(View);t.LoadingUI=e}(ui||(ui={})),function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.createView(t.MyDialogUI.uiView)},i.uiView={type:"Dialog",props:{width:560,height:400},child:[{type:"Image",props:{y:0,x:0,width:560,skin:"ui/dialog-bg.png",height:400,sizeGrid:"57,54,16,15"}},{type:"Label",props:{y:16,x:512,width:33,var:"btn_close",height:31}},{type:"Button",props:{y:291,x:75,var:"confim",stateNum:1,skin:"ui/btn_continue.png"}},{type:"Label",props:{y:74,x:98,width:356,var:"context",height:44,fontSize:30,color:"#ff643c",align:"center"}},{type:"Image",props:{y:133,x:208,width:123,var:"awardImg",height:141}},{type:"Image",props:{y:102,x:60,var:"txtImg"}}]},i}(Dialog);t.MyDialogUI=e}(ui||(ui={})),function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.createView(t.baseDialogUI.uiView)},i.uiView={type:"Dialog",props:{width:640,height:1009},child:[{type:"Label",props:{y:0,width:640,height:1009,bgColor:"#060606",alpha:.1}},{type:"Image",props:{y:304,x:40,width:560,skin:"ui/dialog-bg-noclose.png",sizeGrid:"13,15,12,15",height:400},child:[{type:"Button",props:{y:292,x:75,var:"confim",stateNum:1,skin:"ui/btn_continue.png"}},{type:"Label",props:{y:74,x:45,width:469,var:"context",height:44,fontSize:30,color:"#ff643c",align:"center"}},{type:"Image",props:{y:133,x:208,width:123,var:"awardImg",height:141}},{type:"Image",props:{y:102,x:60,var:"txtImg"}}]}]},i}(Dialog);t.baseDialogUI=e}(ui||(ui={}));var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function a(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(a.prototype=i.prototype,new a)}}(),GameStart=function(t){function e(){var e=t.call(this)||this;return e.btn_rule.on(Laya.Event.MOUSE_DOWN,e,e.setRuleState(!0,e.rule)),e.btn_rule_close.on(Laya.Event.MOUSE_DOWN,e,e.setRuleState(!1,e.rule)),e.setDefaultProp(e.rule),e.btn_my_award.on(Laya.Event.MOUSE_DOWN,e,e.setRuleState(!0,e.my_award)),e.btn_close_award.on(Laya.Event.MOUSE_DOWN,e,e.setRuleState(!1,e.my_award)),e.setDefaultProp(e.my_award),e.btn_bigin.on(Laya.Event.MOUSE_DOWN,e,e.beginHandle),document.body.style.background="#f57747",e}return __extends(e,t),e.prototype.setDefaultProp=function(t){t.scaleX=.5,t.scaleY=.5,t.alpha=0,t.anchorX=.5,t.anchorY=.5,t.pos(Laya.stage.width/2,Laya.stage.height/2)},e.prototype.setRuleState=function(t,e){var i=this;return function(){if(i.rule.visible=!1,i.my_award.visible=!1,t){var a={scaleX:1,scaleY:1,alpha:1};return e.visible=t,void Laya.Tween.to(e,a,200,Laya.Ease.backOut)}i.setDefaultProp(e)}},e.prototype.beginHandle=function(){this.removeSelf(),GameMain.GameView||(GameMain.GameView=new GameView),GameMain.GameView.reset(),Laya.stage.addChild(GameMain.GameView)},e}(ui.IndexUI),__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function a(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(a.prototype=i.prototype,new a)}}(),GameView=function(t){function e(){var e=t.call(this)||this;return e.cardNum=9,e.awardData={2:"积分 x 1",3:"积分 x 3",4:"积分 x 5",5:"百瑞蛋糕1榜",6:"娜可露露蛋糕1榜",7:"越慢玫瑰蛋糕1榜"},e.cardList.mouseHandler=Laya.Handler.create(e,e.cardSelect,null,!1),e.btn_home.on(Laya.Event.CLICK,e,GameMain.returnHome),e}return __extends(e,t),e.prototype.reset=function(){Laya.stage.bgColor="#ff5529",document.body.style.background="#ff5529",e.isAllow=!1,this.initCardListAnimate(),this.updateChanceNum()},e.prototype.initCardListAnimate=function(){for(var t=[],i=0;i<this.cardNum;i++){t.push({card:{skin:"ui/card_init.jpg"}}),this.cardList.getCell(i).x=0,this.cardList.getCell(i).y=0;var a={};-1!==[0,3,6].indexOf(i)?a.x=0:-1!==[1,4,7].indexOf(i)?a.x=211:a.x=422,-1!==[0,1,2].indexOf(i)?a.y=0:-1!==[3,4,5].indexOf(i)?a.y=252:a.y=504,Laya.Tween.to(this.cardList.getCell(i),a,200,Laya.Ease.bounceInOut,null,100*i)}Laya.timer.once(100*this.cardNum,null,function(){e.isAllow=!0}),this.cardList.dataSource=t},e.prototype.updateChanceNum=function(){this.chanceNumClip.index=e.chanceNum},e.prototype.cardSelect=function(t,i){if(t.stopPropagation(),"mousedown"===t.type){if(!e.isAllow||!this.GameStateCheck())return;e.isAllow=!1,this.curIndex=i,Laya.Tween.to(this.cardList.getCell(i).getChildByName("card"),{skewY:360},300,Laya.Ease.bounceIn,Laya.Handler.create(this,this.setCurCardResult))}},e.prototype.setCurCardResult=function(){var t=Math.ceil(100*Math.random()),i=t<50?1:t<35?2:t<25?3:t<20?4:5;5===i&&(i=[5,6,7][Math.floor(3*Math.random())]),this.curAwardType=i;var a={card:{skin:"ui/award_"+i+".png"}};this.cardList.setItem(this.curIndex,a),e.chanceNum-=1,this.updateChanceNum(),Laya.timer.once(1e3,this,this.setOtherCardResult)},e.prototype.setOtherCardResult=function(){for(var t=[],e=0;e<this.cardNum;e++){if(e===this.curIndex)var i={card:{skin:"ui/award_"+this.curAwardType+".png",skewY:0}};else{var a=Math.ceil(100*Math.random()),n=a<50?4:a<25?5:a<15?3:a<10?2:1;5===n&&(n=[5,6,7][Math.floor(3*Math.random())]);var i={card:{skin:"ui/award_"+Math.ceil(7*Math.random())+".png",skewY:0}}}t.push(i)}this.cardList.dataSource=t,Laya.timer.once(300,this,this.showResult)},e.prototype.showResult=function(){var t=this,e="恭 喜 您 获 得";1===this.curAwardType&&(e="\n 运气不佳，差一点点~ \n \n 再接再厉！"),this.noCloseDialog=new noCloseDialog(e,"ui/btn_continue.png",function(){t.noCloseDialog.close(),t.GameStateCheck()&&t.reset()}),1===this.curAwardType?(this.noCloseDialog.awardImg.removeSelf(),this.noCloseDialog.confim.y=260):this.noCloseDialog.awardImg.skin="ui/award_"+this.curAwardType+".png",this.noCloseDialog.popup(!0),Laya.stage.addChild(this.noCloseDialog)},e.prototype.GameStateCheck=function(){return e.chanceNum<=0&&!e.isShared?(this.haveToShareDialog(),!1):!(e.chanceNum<=0)||(this.todayNoChance(),!1)},e.prototype.haveToShareDialog=function(){var t=this;this.noCloseDialog=new noCloseDialog("","ui/btn_share.png",function(){t.noCloseDialog.close(),e.showHtmlTip("share-model")}),this.noCloseDialog.txtImg.skin="ui/nochance_txt.png",this.noCloseDialog.popup(!0),Laya.stage.addChild(this.noCloseDialog)},e.prototype.haveToFollow=function(){var t=this;this.noCloseDialog=new noCloseDialog('\n \b点击关注公众号 "\b迈小步科技"\n \n 可提高概率哦~',"ui/btn_follow.png",function(){t.noCloseDialog.close(),e.showHtmlTip("follow-model")}),this.noCloseDialog.confim.y=260,this.noCloseDialog.popup(!0),Laya.stage.addChild(this.noCloseDialog)},e.prototype.todayNoChance=function(){this.noCloseDialog=new noCloseDialog("今天的机会已经用完啦，\b\n\b\n 明天再来吧~","ui/btn_bye.png",this.noCloseDialog.close),this.noCloseDialog.popup(!0),Laya.stage.addChild(this.noCloseDialog)},e.showHtmlTip=function(t){document.getElementById(t).style.display="block"},e.prototype.getRandom=function(){return Math.ceil(9*Math.random())},e.chanceNum=5,e.historyChanceNum=100,e.isFollow=!1,e.isShared=!0,e.isAllow=!1,e}(ui.GameViewUI),__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function a(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(a.prototype=i.prototype,new a)}}(),Loading=function(t){function e(){var e=t.call(this)||this;return e.progress.text="0%",e}return __extends(e,t),e}(ui.LoadingUI),__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function a(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(a.prototype=i.prototype,new a)}}(),MyDialog=function(t){function e(e,i){var a=t.call(this)||this;return a.context.text=e,a.btn_close.on(Laya.Event.CLICK,a,a.close),a.confim.on(Laya.Event.CLICK,a,i),a.dragArea="7,21,493,18",a.closeEffect=null,a}return __extends(e,t),e}(ui.MyDialogUI),__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function a(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(a.prototype=i.prototype,new a)}}(),noCloseDialog=function(t){function e(e,i,a){var n=t.call(this)||this;return n.init(),n.context.text=e,n.confim.once(Laya.Event.CLICK,n,a),n.closeEffect=null,n.confim.skin=i,n}return __extends(e,t),e.prototype.init=function(){this.context.text="",this.context.x=98,this.context.y=74,this.context.width=356,this.awardImg.skin="",this.awardImg.x=208,this.awardImg.y=133,this.awardImg.width=123,this.awardImg.height=141,this.txtImg.x=60,this.txtImg.y=120,this.txtImg.skin="",this.confim.y=292},e}(ui.baseDialogUI);